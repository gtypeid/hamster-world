# Kafka Topology - 전체 시스템의 서비스 및 토픽 정의
#
# 이 파일은 인프라 레벨 설정으로, 모든 서비스가 참조합니다.
# - 서비스명 정의: 시스템에 존재하는 모든 서비스
# - 토픽 정의: Kafka 토픽 이름, 파티션, 복제 팩터, 소유자
#
# 이 파일을 수정하면:
# 1. EventRegistryValidator가 검증 (존재하지 않는 토픽 참조 시 애플리케이션 종료)
# 2. (선택적) KafkaTopicInitializer가 토픽 자동 생성
#
# ========================================
# Spring Property 자동 등록 (KafkaTopologyPropertyRegistrar)
# ========================================
# 이 파일의 서비스/토픽 정보는 자동으로 Spring Property로 등록됩니다:
#
# 1. kafka.topics.{토픽명} = {토픽명}
#    예: kafka.topics.ecommerce-events = ecommerce-events
#    사용처: kafka-event-registry.yml의 subscribes에서 다른 서비스 토픽 구독 시
#    예시: topic: ${kafka.topics.payment-events}
#
# 2. kafka.service.{서비스명}.topic = {첫 번째 소유 토픽}
#    예: kafka.service.ecommerce-service.topic = ecommerce-events
#    사용처: kafka-event-registry.yml의 publishes에서 자기 서비스 토픽에 발행 시
#    예시: topic: ${kafka.service.ecommerce-service.topic}

# ========================================
# 서비스 정의
# ========================================
# owns: 이 서비스가 소유한 토픽 목록 (발행하는 토픽)
#       - 첫 번째 토픽이 ${kafka.service.{서비스명}.topic}으로 등록됨
services:
  - name: ecommerce-service
    description: E-commerce 서비스 (주문, 상품 관리)
    owns:
      - ecommerce-events

  - name: payment-service
    description: Payment 서비스 (재고 관리, 결제 검증)
    owns:
      - payment-events

  - name: cash-gateway-service
    description: Cash Gateway 서비스 (PG 연동)
    owns:
      - cash-gateway-events

  - name: hamster-pg-service
    description: Hamster PG 서비스 (외부 PG, 참고용)
    owns: []

  - name: progression-service
    description: Progression 서비스 (Archive, Quota 관리)
    owns:
      - progression-events

# ========================================
# 토픽 정의
# ========================================
topics:
  - name: ecommerce-events
    partitions: 3
    replication-factor: 1
    description: E-commerce Service 이벤트 (상품 생성, 재고 조정 요청, 주문 생성)

  - name: payment-events
    partitions: 3
    replication-factor: 1
    description: Payment Service 이벤트 (재고 확보 완료, 재고 동기화)

  - name: cash-gateway-events
    partitions: 3
    replication-factor: 1
    description: Cash Gateway Service 이벤트 (결제 승인, 실패, 취소)

  - name: progression-events
    partitions: 3
    replication-factor: 1
    description: Progression Service 이벤트 (Archive 완료/클레임, Quota 완료/클레임)
